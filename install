#!/usr/bin/bash

# install all files to ~ by symlinking them,
# this way, updating them is as simple as git pull
#
# Author: Dave Eddy <dave@daveeddy.com>
# Date: May 25, 2012
# License: MIT

# Source .env file
. ./env

# makes "defaults" command print to screen
defaults() {
	echo defaults "$@"
	command defaults "$@"
}

# verbose ln, because `ln -v` is not portable
symlink() {
	printf '%55s -> %s\n' "${1/#$HOME/\~}" "${2/#$HOME/\~}"
	ln -nf "$@"
}

# Link dotfiles and folders
dotfiles=(
	bash_completion
	bash_profile
	bashrc
	gitconfig
	bash_aliases
	hushlogin
	conkyrc
	duckdns
)
for f in "${dotfiles[@]}"; do
	[[ -d ~/.$f && ! -L ~/.$f ]] && rm -r ~/."$f"
	[[ -f ./"$f" ]] && symlink "$PWD/$f" ~/."$f"
	[[ -d ./"$f" ]] && cp -r "$PWD/$f" ~/."$f"
done

echo "$USER ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee "/etc/sudoers.d/dont-prompt-$USER-for-sudo-password"


# Set up crontab

crontab -l > crontab_new

if [ -f ~/.local/bin/yt-dlp ]; then
	echo "0 3 * * * ~/.local/bin/yt-dlp --config-location ~/dotfiles/dlp.conf -a /export/PlexMedia/Youtube/urls.txt --force-overwrite > ~/dlp.log" >> ./crontab_new
fi
echo "*/5 * * * * ~/.duckdns/duck.sh >/dev/null 2>&1" >> ./crontab_new

crontab ./crontab_new
rm ./crontab_new
